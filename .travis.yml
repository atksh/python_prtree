language: python
dist: bionic
compiler:
- gcc
jobs:
  include:
  - services: docker
  - os: osx
    language: shell
  - os: windows
    language: shell
    before_install:
      - choco install python --version 3.8.0
      - export PATH="/c/Python38:/c/Python38/Scripts:$PATH"
      - ln -s /c/Python38/python.exe /c/Python38/python3.exe
env:
  global:
  - CIBW_BUILD="cp3?-*"
  - CIBW_SKIP="cp27-* *-win32 *-manylinux_i686"
  - CIBW_BEFORE_BUILD="pip install pybind11"
  - TWINE_USERNAME=__token__
install:
- python3 -m pip install cibuildwheel
script:
- python3 -m cibuildwheel --output-dir wheelhouse
after_success:
- |
  if [[ $TRAVIS_TAG ]]; then
    python3 -m pip install twine
    python3 -m twine upload wheelhouse/*.whl
  fi
