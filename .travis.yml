language: python
dist: bionic
compiler:
- gcc
jobs:
  include:
  - services: docker
  - os: osx
    language: shell
env:
  global:
  - OMP_NUM_THREADS=4
  - CIBW_BUILD="cp3?-*"
  - CIBW_SKIP="cp27-* *-win *-manylinux_i686"
  - CIBW_BEFORE_BUILD="pip install pybind11"
  - TWINE_USERNAME=__token__
install:
- python3 -m pip install cibuildwheel
script:
- python3 -m cibuildwheel --output-dir wheelhouse
after_success:
- |
  if [[ $TRAVIS_TAG ]]; then
    python3 -m pip install twine
    python3 -m twine upload wheelhouse/*.whl
  fi
